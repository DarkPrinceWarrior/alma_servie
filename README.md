# Система обнаружения аномалий в нефтяных скважинах

## Описание проекта
Данный проект реализует автоматизированную систему для обнаружения аномалий в высокочастотных данных датчиков нефтяных скважин. Система нацелена на выявление двух специфических типов отклонений:

1. **Негерметичность (Утечка)**: Внезапные изменения давления на приеме. Обнаруживаются с использованием библиотеки Ruptures (алгоритм PELT) в сочетании с фильтром стабильности частоты, чтобы отличить реальные утечки от операционных изменений работы насоса.
2. **Приток**: Устойчивые постепенные тренды давления. Обнаруживаются с использованием скользящей линейной регрессии (Sliding Window Linear Regression), которая находит длительные положительные или отрицательные наклоны, указывающие на геологические изменения притока.

Система обрабатывает сырые данные датчиков, определяет время начала аномалии, проверяет результаты по эталонным данным (ground truth) и генерирует визуальный HTML-отчет.

## Требования
- Python 3.8 или выше
- pip (установщик пакетов Python)

## Установка

### 1. Клонирование или загрузка репозитория
Перейдите в директорию проекта, где находятся файлы.

### 2. Создание виртуального окружения
Рекомендуется использовать виртуальное окружение для управления зависимостями.

**На macOS и Linux:**
```bash
python3 -m venv venv
source .venv/bin/activate
```

**На Windows (Command Prompt):**
```cmd
python -m venv venv
venv\Scripts\activate
```

**На Windows (PowerShell):**
```powershell
python -m venv venv
.\venv\Scripts\Activate.ps1
```

### 3. Установка зависимостей
Установите необходимые библиотеки Python, используя файл requirements.txt.

```bash
pip install -r requirements.txt
```

**Ключевые зависимости:**
- `pandas`: Обработка и анализ данных.
- `ruptures`: Алгоритмы обнаружения точек изменения (Change Point Detection).
- `scipy`: Научные вычисления (линейная регрессия).
- `matplotlib`: Визуализация данных.
- `numpy`: Числовые вычисления.

## Структура проекта

- `detect_anomalies.py`: Основной скрипт выполнения. Загружает данные, запускает оба алгоритма обнаружения, сравнивает результаты с эталоном и сохраняет результаты в CSV-файл.
- `generate_static_report.py`: Инструмент отчетности, который читает результаты обнаружения и генерирует автономный HTML-файл со встроенными таблицами и графиками.
- `db/`: Директория, содержащая входные данные (`wells_database.csv`) и эталонные метки (`wells_svod.csv`).
- `requirements.txt`: Список зависимостей проекта.

## Использование

### Шаг 1: Запуск обнаружения аномалий
Запустите основной скрипт обнаружения. Он обработает данные, выведет прогресс в консоль и создаст файл результатов.

```bash
python detect_anomalies.py
```

**Результат:**
- Логи в консоли, показывающие статус обнаружения для каждой скважины.
- `anomaly_detection_results.csv`: Табличная сводка обнаруженных аномалий.

### Шаг 2: Генерация визуального отчета
После завершения обнаружения запустите генератор отчета.

```bash
python generate_static_report.py
```

**Результат:**
- `anomaly_report_static.html`: Полностью автономный файл отчета, содержащий сводную таблицу и встроенные графики для всех проанализированных скважин.

## Интерпретация результатов

Система выводит сравнение между временем обнаруженной аномалии и фактическим временем (из эталонных данных).

- **Status**: Указывает, была ли аномалия "Detected" (Обнаружена) или "Not found" (Не найдена).
- **Логика Негерметичности**: Ищет резкие сдвиги давления (> 0.5 атм), при которых частота насоса остается стабильной (изменение < 0.5 Гц).
- **Логика Притока**: Ищет устойчивые 24-часовые тренды с высокой линейностью (R-squared > 0.6) и значимым наклоном.

Для просмотра результатов просто откройте файл `anomaly_report_static.html` в любом современном веб-браузере.
