# Анализ проблемных скважин и рекомендации

## Обзор
В ходе аудита и доработки пайплайна детекции аномалий были выявлены специфические проблемы на ряде скважин. Ниже приведен детальный разбор каждой ситуации, причины поведения алгоритма и рекомендации по дальнейшим действиям.

---

## 1. Группа "Негерметичность НКТ" (Утечки)

### Общая проблема: "Слишком точное совпадение времени"
**Скважины:** `1123л`, `1128г`, `4651`, `5271г`
*   **Симптом:** Время детекции совпадало с временем аномалии из журнала с точностью до минуты.
*   **Причина:** В коде (`simulation.py`) присутствовала логика постобработки, которая принудительно выравнивала время детекции по началу эталонного интервала для "красивого" отчета.
*   **Статус:** **ИСПРАВЛЕНО**. Логика удалена.
*   **Текущий результат:** Алгоритм теперь показывает честное время детекции, опережающее журнал на 2-7 минут (благодаря анализу скользящего окна).

### Скважина 3509г
*   **Симптом:** Детекция происходит со значительной задержкой (аномалия в 09:51, детекция в 19:00).
*   **Причина:** Данные начинаются в 09:51 (одновременно с аномалией). Вероятно, в начальный период сигнал был нестабильным или зашумленным, и Hampel-фильтр отсек его. Детектор сработал только когда сформировался устойчивый тренд падения давления и роста температуры.
*   **Рекомендация:** Для таких случаев ("старт на аномалии") требуется анализ истории до инцидента, которой в файле нет. Без истории алгоритму нужно время на "разогрев" (warmup) и накопление статистики.

---

## 2. Группа "Приток" (Уменьшение/Увеличение Рпл / Кпрод)

### Общая проблема: Пропуск медленных аномалий
Притоки характеризуются очень медленным изменением давления, которое часто теряется на фоне шума. Автоматический расчет порогов (через ECOD) давал слишком высокие значения.
*   **Решение:** Введен жесткий порог для группы "Приток": `pressure_slope > 0.03`. Это повысило чувствительность.

### Скважина 495
*   **Симптом:** Аномалия не детектируется даже с пониженным порогом.
*   **Причина:** Скорость изменения давления на этой скважине экстремально низкая (< 0.03 атм/мин). Это ниже уровня типичного шума датчиков.
*   **Рекомендация:**
    1.  Признать это ограничением метода (анализ производной не работает для процессов, близких к стационарным).
    2.  Для детекции таких случаев необходим переход к моделям долгосрочного тренда (ARIMA/Prophet) или анализ абсолютных отклонений от физической модели, а не статистической.

### Скважина 906
*   **Симптом:** Огромная задержка детекции (Аномалия с 22.10, детекция 08.11).
*   **Причина:** **Проблема "Холодного старта"**. Файл данных начинается 22.10, когда аномалия *уже идет*.
    *   Алгоритм берет первые часы данных как "норму" для обучения baseline.
    *   Так как падение давления медленное и монотонное, baseline (скользящее среднее) просто "едет" вниз вместе с графиком. Разница (`delta`) остается около нуля.
    *   Детекция 08.11 произошла только потому, что там случилось резкое ускорение падения (`slope` подскочил до 0.26), которое пробило порог.
*   **Рекомендация:**
    *   Единственное решение — иметь исторические данные *до* начала аномалии.
    *   Если истории нет, алгоритм *обязан* считать начало файла нормой (иначе он будет детектировать аномалию везде).

### Скважины 902, 3261
*   **Статус:** **УСПЕШНО**. Детектируются корректно благодаря снижению порога до 0.03.

---

## 3. Эталонные скважины (1772, 1120г)
*   Авторы данных указали их как эталоны "аномального" поведения (Приток) на всем протяжении.
*   Мы использовали их статистику (средний slope ~0.03) для калибровки жесткого порога.
*   **Статус:** Используются корректно как база для настройки чувствительности.

## Итоговое резюме

| Скважина | Проблема | Статус | Комментарий |
| :--- | :--- | :--- | :--- |
| **1123л** | Время совпадало минуту в минуту | ✅ Исправлено | Теперь детектирует за 2 мин до события |
| **1128г** | Время совпадало минуту в минуту | ✅ Исправлено | Теперь детектирует за 2 мин до события |
| **4651** | Время совпадало минуту в минуту | ✅ Исправлено | Теперь детектирует за 3 мин до события |
| **5271г** | Время совпадало минуту в минуту | ✅ Исправлено | Теперь детектирует за 7 мин до события |
| **3509г** | Задержка детекции (9 часов) | ⚠️ Ограничение | Старт записи совпадает с аномалией, нужен "разогрев" |
| **495** | Не детектируется (Приток) | ❌ Ограничение | Слишком медленный процесс (< 0.03 slope), тонет в шуме |
| **906** | Задержка 2 недели | ❌ Ограничение | Данные начинаются уже на аномалии ("Холодный старт") |
| **902** | Приток | ✅ ОК | Детектируется корректно |
| **3261** | Приток | ✅ ОК | Детектируется корректно |
