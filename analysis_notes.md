# Наблюдения и идеи по текущим данным

## Объединённые таблицы
- **АГЗУ** (`АГЗУ_объединенные.csv`): ~3.0 тыс. строк по 16 скважинам, период с 2024-01-01 по 2024-12-31, шаг времени очень неровный — на каждой скважине десятки и сотни разрывов больше суток; встречаются отрицательные значения дебита жидкости (5 точек до −1.97e6) и давления (≈40 точек), длительность замеров достигает 5027 минут при плановых 60–1440, что намекает на выбросы/ошибки учёта.
- **СУ** (`СУ_объединенные.csv`): 4.36 млн строк, шаг от секунд до часов, охватывает период до 2025-10-19, полный набор скважин совпадает с АГЗУ; NaN только в колонке "Устьевое давление" (≈535 тыс. пробелов, но концентрируются на скважинах 40617, 48361, 50184), зато ~70% оставшихся давлений равны нулю; ток, коэффициент загрузки, частота и др. часто уходят в длинные нулевые плато и содержат экстремумы (загрузка до 316, температура двигателя до 652, давление на приёме >600).
- **Анализ аномалий** (`Анализ_аномалий_результат (3).xlsx`): 13 аномалий (май–декабрь 2024), часть столбцов с метриками АГЗУ пустая — значит, в окнах «3 дня до» или «в период» не набиралось данных; значения СУ присутствуют всегда, но без фильтрации резких выбросов.

## Что делал ноутбук `DA_All.ipynb`
- Сбор данных (`cell 1`): читает все Excel из `data/`, берёт листы "Замеры АГЗУ из ТМ" (полностью) и "Замеры СУ" (7 колонок); итоговые CSV сформированы заранее, так что ноутбук можно считать исходником пайплайна.
- Заполнение пропусков (`cell 2`): реализовано **только** для СУ — по каждой скважине сначала `ffill`, затем `bfill`. Нули считаются валидными, а NaN тянутся до ближайших значений. Для АГЗУ отдельной логики нет.
- Анализ аномалий (`cells 3–6`): берёт `./альма/Общая таблица.xlsx`, режет окна "3 дня ДО" и "период аномалии" для каждой скважины/события и считает проценты изменений без дополнительного контроля выбросов.

## Вопросы и риски, требующие уточнения
1. **Разрывы по времени**: если это простои скважин, нужно официально подтвердить, чтобы не заполнять их автоматически. Готов собрать отчёт по интервалам >24 ч и передать технологам.
2. **Нулевые плато в СУ**: формально трактуются как реальные измерения, но стоит проверить, не маскируют ли они аварийные/стоп режимы. Заполнение NaN `ffill/bfill` оставляет нули как есть.
3. **Выбросы и экстремумы**: отрицательные дебиты, сверхвысокие температуры и коэффициент загрузки >150 выглядят подозрительно; перед расчётом отклонений нужно согласовать правила фильтрации/ограничения.
4. **Разные временные шкалы**: без приведения к единому шагу (ресемплинг, `merge_asof`, агрегирование) сравнение СУ vs АГЗУ и работа с окнами аномалий остаётся непрозрачной.
5. **Производительность**: объём СУ (~4.3 млн строк) требует оптимизации (форматы parquet/feather, выборочные загрузки, отчёты качества), чтобы пайплайн был воспроизводимым.

## Предложенные следующие шаги
1. Согласовать с технологами трактовку разрывов >24 ч и подготовить их список по каждой скважине.
2. Уточнить, как относиться к нулевым показаниям и нужно ли дополнительное заполнение или маркировка плато как простоев.
3. Вынести обработку из ноутбука в отдельный скрипт/модуль, добавить контрольные проверки (выбросы, длительные нули, процент заполнения) и логирование.
4. Привести данные к общей временной сетке (например, часовой) и пересчитать аномалии уже на очищенных и унифицированных сериях.
5. После согласования правил построить обновлённые отчёты по аномалиям и добавить визуализации/индикаторы качества для оперативной проверки.
